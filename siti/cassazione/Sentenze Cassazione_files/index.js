/*!
 * This file is part of Z.
 *
 * Copyright 2010-2014, http://www.maas.ccr.it/z.licence/AUTHORS
 * Licensed under the GPL Version 3 license
 * http://www.maas.ccr.it/z.licence
 *
 */
(function(){var Y={docsxrow:10,snippetFl:"ocr",docStart:1,keyModel:[],keyElement:[],dataModel:[],dataElement:[],metaElement:[],db:"",selid:"",hlSelid:"",selcount:0,startquery:null,starthlquery:"nomatch",lockCount:0,queryElement:null,lastQuery:"",lastHlQuery:"",sort:"pd desc,datdec desc,anno desc,numdec desc",solr:"/sn.solr/sn-collection",solrIsapi:"isapi/hc.dll/sn.solr/sn-collection",estremi:"estremi",estremiIsapi:"isapi/hc.dll/sn/estremi",theEnd:""};Y.register=function(a,b,e){a.push(e.cloneNode(true));b.push(e)};Y.registerKey=function(e){this.register(this.keyModel,this.keyElement,e);var name="["+e.getAttribute("data-arg")+"]";var label=e.getAttribute("data-label");if(!label||label==""){label=e.getAttribute("data-arg")}var floating=e.getAttribute("data-mode");floating=(floating!=null&&floating=="floating"?true:false);K.registerKey(e,name,label,floating)};Y.registerData=function(e){this.register(this.dataModel,this.dataElement,e)};Y.registerMeta=function(e){this.metaElement.push(e)};Y.registerSource=function(e){this.db=e.getAttribute("value")};Y.registerQuery=function(e){this.queryElement=e};Y.keyList=function(){var result="";for(var i=0;i<this.keyModel.length;i++){if(result!=""){result+=";"}result+=this.keyModel[i].getAttribute("data-arg")}return result};Y.dataList=function(separ){var result="";var data=new Array();for(var i=0;i<this.dataModel.length;i++){jQuery.each($('*[data-role="content"][data-arg]',this.dataModel[i]),function(index,elem){data[elem.getAttribute("data-arg")]=""});jQuery.each($('*[data-role="multivaluedcontent"][data-arg]',this.dataModel[i]),function(index,elem){data[elem.getAttribute("data-arg")]=""})}for(a in data){if(result!=""){result+=separ?separ:";"}result+=a}return result};Y.updateMeta=function(response){for(var i=0;i<this.metaElement.length;i++){if(this.metaElement[i].getAttribute("data-arg")=="start"){var value=eval("response."+this.metaElement[i].getAttribute("data-arg"));if(value>=0){$(this.metaElement[i]).text("@"+(1+value))}}else{$(this.metaElement[i]).text(eval("response."+this.metaElement[i].getAttribute("data-arg")))}}};function formatAttrValue(tpl,docData,instance,position){var start=tpl.indexOf("$val{");if(start>=0){var stop=tpl.indexOf("}",start);var arg=tpl.substring(start+5,stop);var val=window.Y.writeContent(docData,arg,instance,position);return formatAttrValue(tpl.substring(0,start)+val+tpl.substring(stop+1),docData,instance,position)}else{return tpl}}function updateNodeContent(doc,elem,instance,position){var arg=elem.getAttribute("data-arg");if(arg!=""){var attr=elem.getAttribute("data-attr");var value=window.Y.writeContent(doc,arg,instance,position);if(attr&&attr.length){attr=attr.split("|");for(var k=0;k<attr.length;k++){var singleAttr=attr[k].split("=");try{$(elem).attr(singleAttr[0],singleAttr.length>1?formatAttrValue(singleAttr[1],doc,instance,position):value)}catch(e){}}}else{$(elem).html(value)}}var id=$(elem).attr("id");var start=id.indexOf("$val{");if(start>=0){var stop=id.indexOf("}",start);var arg=id.substring(start+5,stop);$(elem).attr("id",id.substring(0,start)+doc[arg][instance]+id.substring(stop+1))}}function writeContent(doc,name,instance,position){var val=doc.highlighting&&doc.highlighting[name]?doc.highlighting[name]:doc[name];if(instance>=0){val=val[instance]}else{if(!(typeof val==="string")){val=val[0]}}return val}function parseTemplate(container,template,doc,position){jQuery.each($('*[data-role="datasubset"][data-arg]',template),function(index,elem){try{var instances=doc[elem.getAttribute("data-arg")].length;for(var instance=instances-1;instance>=0;instance--){var repeatableNode=elem.cloneNode(true);jQuery.each($('*[data-role="multivaluedcontent"][data-arg]',repeatableNode),function(index,elem){try{updateNodeContent(doc,elem,instance,position)}catch(e){}});$(repeatableNode).insertAfter(elem)}$(elem).remove()}catch(e){}});jQuery.each($('*[data-role="content"][data-arg]',template),function(index,elem){try{updateNodeContent(doc,elem,-1,position)}catch(e){}});if(position||position===0){jQuery.each($('*[data-role="meta"][data-arg]',template),function(index,elem){switch(elem.getAttribute("data-arg")){case"position":$(elem).text(position)}})}jQuery.each($(template).children(),function(index,elem){$(container).append(elem);window.onYDocUpdateDone(elem,doc)})}Y.updateData=function(response){for(var i=0;i<this.dataModel.length;i++){jQuery.each($(this.dataElement[i]).children(),function(index,elem){$(elem).remove()});for(j=0;j<response.docs.length;j++){var newNode=this.dataModel[i].cloneNode(true);parseTemplate(Y.dataElement[i],newNode,response.docs[j],response.start+j)}}};window.onYDocUpdateDone=function(){};var listResizeClass="keylistResize";var listAlsoResizeClass="keylistAlsoResize";var listMinHeight=15;var resizeInitialized=false;var sliderInitialized=false;function removeResizables(){if(resizeInitialized){$("."+listResizeClass).resizable("destroy")}resizeInitialized=false}function insertResizables(){$("."+listResizeClass).resizable({alsoResize:"."+listAlsoResizeClass},{handles:"s"},{ghost:false},{autoHide:true},{grid:[0,0]},{minHeight:listMinHeight});resizeInitialized=true}function insertDocSlider(){var rows=Math.floor(Math.floor(parseInt(Y.selcount)+Y.docsxrow-1)/Y.docsxrow);$("#slider").slider({min:1},{max:rows},{value:rows},{animate:true},{orientation:"vertical"},{change:function(event,ui){var rows=Math.floor(Math.floor(parseInt(Y.selcount)+Y.docsxrow-1)/Y.docsxrow);var docOffset=1+Y.docsxrow*(rows-ui.value);if(docOffset!=Y.docStart){updateDocOffset(docOffset)}}});sliderInitialized=true}function doneWithUpdate(sliding){Y.lock(false);if(!Y.locked()){if(!sliding){insertResizables()}if(!sliding){insertDocSlider()}$("#slider").slider("option","disabled",false);if(sliding){$(".ui-slider-handle").focus()}Y.fadeIn(sliding)}}Y.listFacets=function(hidden){var result=new Array();for(var i=0;i<this.keyElement.length;i++){var mode=this.keyElement[i].getAttribute("data-mode");if(mode==null||mode!="floating"){var styleDisplay=this.keyElement[i].parentNode.style.display;if((hidden&&styleDisplay=="none")||(!hidden&&styleDisplay!="none")){result.push([this.keyElement[i].getAttribute("data-arg"),this.keyElement[i].getAttribute("data-label")])}}}return result};Y.listHiddenFacets=function(){return this.listFacets(true)};Y.listVisibleFacets=function(){return this.listFacets(false)};Y.isKeyVisible=function(index){return this.keyElement[index].parentNode.style.display!="none"};Y.updateKeys=function(){removeResizables();var attributeNames="";for(var i=0;i<this.keyElement.length;i++){var mode=this.keyElement[i].getAttribute("data-mode");if(this.isKeyVisible(i)&&(mode==null||mode!="floating")){if(window.Y.openKeyLists){this.lock(true);window.Y.openKeyLists(this.keyElement[i].getAttribute("data-arg"),window.Y.doneWithUpdate)}}}};Y.queryResponse=function(r,sliding){if(r.response.numFound<=0){alert("no document");return false}this.selcount=r.response.numFound;this.selid=r.responseHeader.params.q;this.hlSelid=r.responseHeader.params["hl.q"];if(!sliding){this.updateKeys()}this.updateMeta(r.response);this.updateData(r.response);$("#totCount").html('<span class="tot">'+numFormat(r.response.numFound)+" </span>");return true};function hl2doc(doc,hl){if(hl){doc.highlighting=hl}}function parseDocsResponse(result){var r=jQuery.parseJSON(result);if(r.highlighting){var docs=r.response.docs;for(var j=0;j<docs.length;j++){var hl=r.highlighting[docs[j].id];window.Y.hl2doc(docs[j],hl)}}return r}Y.update=function(result,sliding){var retval=null;try{var r=window.Y.parseDocsResponse(result);if(r.error){alert(r.error)}else{retval=window.Y.queryResponse(r,sliding)}}catch(e){alert("update error:"+e)}return retval};Y.lock=function(lock){this.lockCount+=lock?1:-1};Y.locked=function(){return this.lockCount>0};Y.fadeOut=function(sliding){$("#z-form").stop(true,true).fadeTo(200,0.5)};Y.fadeIn=function(sliding){$("#z-form").stop(true,true).fadeTo(200,1)};Y.hasSort=function(q){q=q||Y.lastQuery;var pos=q.indexOf(":");if(pos<0){return false}var apos=q.indexOf(" AND ");return apos<0||apos>pos};function loadData(docStart,sliding){Y.lock(true);Y.fadeOut(sliding);if(sliderInitialized){$("#slider").slider("option","disabled",true)}Y.docStart=docStart;var kindArg=K.input2Query("","[kind]").split('"');kindArg=(kindArg.length>1?"="+kindArg[1]:"");var q=encodeURIComponent(Y.lastQuery)+(Y.fuzzy?"&fuzzy=true":"");$.ajax({type:"POST",url:window.Y.solr()+"/select?app.query"+kindArg,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"start="+(docStart-1)+"&rows="+window.Y.docsxrow(Y.lastQuery)+"&q="+q+"&wt=json&indent=off"+((!Y.fuzzy&&window.Y.hasSort(Y.lastQuery))?"&sort="+window.Y.sort():"")+"&fl="+encodeURIComponent(Y.dataList(","))+"&hl=true&hl.snippets=4&hl.fragsize=100&hl.fl="+Y.snippetFl+(Y.lastHlQuery?"&hl.q="+encodeURIComponent(Y.lastHlQuery):"")+"&hl.maxAnalyzedChars=1000000&hl.simple.pre="+encodeURIComponent('<em class="hit">')+"&hl.simple.post="+encodeURIComponent("</em>"),success:function(result){var retval=Y.update(result,sliding);if(retval&&retval.reload){Y.lock(false);retval.reload()}else{window.Y.doneWithUpdate(sliding)}},error:function(xhr,settings,exception){window.Y.doneWithUpdate(sliding);alert("query error: "+exception+", status:"+xhr.status)}});$.ajax({type:"GET",url:"http://"+location.hostname+"/xway/application/nif/isapishare/hc.dll?app.query"+kindArg+"&q="+q,async:true,success:function(result){},error:function(xhr,settings,exception){consoleLog("query tracking error: "+exception+", status:"+xhr.status)}})}function updateDocOffset(start){loadData(start,true)}Y.load=function(query,position,hlQuery){this.lastQuery=query;this.lastHlQuery=hlQuery;loadData(position?position:1,false)};Y.isSelection=function(value){return value&&value.length&&value.substring(0,1)=='"'&&value.substring(value.length-1)=='"'};var solr2escape='/\\+-&|!(){}[]^~*?:"; ';function escapeSolrValue(s){var result="";for(var j=0;j<s.length;j++){var ch=s.charAt(j);if(solr2escape.indexOf(ch)>=0){result+="\\"}result+=ch}return result}function checkEstremi(val){val=trim(val.replace(/\//g," / ").replace(/\./g," ").replace(/\s+/g," "));val=val.toLowerCase().split(" ");if(val.length<3||val.length>6){return null}var year=(new Date()).getFullYear();var anno=null,num=null,tipo=null;var intRegex=/^\d+$/;for(var j=0;j<val.length;j++){var tkn=val[j];if(!tipo){if(tkn.indexOf("dec")==0){tipo='tipoprov:"Decreto"'}else{if(tkn.indexOf("ord")==0){tipo='tipoprov:"Ordinanza" OR tipoprov:"Ordinanza Interlocutoria"'}else{if(tkn.indexOf("sent")==0){tipo='tipoprov:"Sentenza"'}}}}if(intRegex.test(tkn)){if(!num){if(tkn.length<6&&((j>0&&(val[j-1]=="n"||val[j-1]=="num"))||(j>1&&val[j-1]=="/")||(j+2<val.length&&val[j+1]=="/"))){num=tkn}if(num){while(num.length<5){num="0"+num}num='numdec:"'+num+'"';continue}}if(!anno){var y=null;if((j>0&&val[j-1]=="del")||(j>1&&val[j-1]=="/")||(j+2<val.length&&val[j+1]=="/")){y=tkn}if(y){if(y.length==2){var t=(""+year).substring(0,2)+y;if(parseInt(t,10)<=year){anno=t}else{anno="19"+y}}if(y.length==4){y=parseInt(y,10);if(y<=year&&y>=year-7){anno=y}}if(anno){anno='anno:"'+anno+'"';continue}}}}}if(anno&&num){return anno+" AND "+num+(tipo?" AND "+tipo:"")}return null}function checkSyntax(val){return val.replace(/^NOT +/g," -").replace(/ NOT +/g," -")}function hasXcludeSyntax(val){return val.indexOf(" NOT ")>0||val.indexOf("NOT ")==0}function hasSyntax(val){return val.indexOf("*")>=0||val.indexOf('"')>=0||val.indexOf(" AND ")>0||val.indexOf(" OR ")>0}function freeTextQuery(qe,xtend,hl,fuzzy){if(!qe||!qe.value||trim(qe.value)==""){return null}var val=trim(qe.value);if(fuzzy){if(hasXcludeSyntax(val)){val=checkSyntax(val)}val=trim(val.replace(/\./g," ").replace(/\s+/g," ").replace(/"/g,"").replace(/ AND /g," OR "));val=val.split(" ");var result="";for(var j=0;j<val.length;j++){if(val[j]=="OR"){result+=" "+val[j]+" "}else{if(result!=""){result+=" OR "}result+=val[j]+(val[j].charAt(0)=="-"?"":"~")}}return result}if(hl){if(Y.isSelection(val)){return escapeSolrValue(val.replace(/"/g,""))}if(val.indexOf(" ")>0){return escapeSolrValue(val.replace(/"/g,""))+(xtend?"*":"")}}else{var result=checkEstremi(val);if(result){return result}if(hasXcludeSyntax(val)){val=checkSyntax(val)}if(hasSyntax(val)){return val}if(val.indexOf(" ")>0){return'"'+val.replace(/"/g,"")+(xtend?"*":"")+'"~7'}}return escapeSolrValue(val.replace(/"/g,""))+(xtend?"*":"");return query}function rifTextQuery(fuzzy){return estremiQuery(fuzzy)}Y.buildHlQuery=function(arg,suggest,fuzzy){var query="nomatch";var freeText=freeTextQuery(this.queryElement,suggest,true,fuzzy);if(freeText){if(query.length>0){query+=" AND "}query+="("+freeText+")";if(suggest){return query}}var rifText=rifTextQuery(!freeText?fuzzy:false);if(rifText){if(query.length>0){query+=" AND "}query+="("+rifText+")"}if(arg&&arg.length>0){if(query.length>0){query+=" AND "}query+="("+arg+")"}for(var i=0;i<this.keyElement.length;i++){var name="["+this.keyElement[i].getAttribute("data-arg")+"]";query=K.input2Query(query,name)}return query};Y.buildQuery=function(arg,noui,inputName,xtend,fuzzy){var query="";fuzzy=fuzzy||this.fuzzy;xtend=xtend==undefined?noui:xtend;var freeText=freeTextQuery(this.queryElement,xtend,null,fuzzy);if(freeText){if(query.length>0){query+=" AND "}query+="("+freeText+")"}var rifText=rifTextQuery(fuzzy);if(rifText){if(query.length>0){query+=" AND "}query+="("+rifText+")"}if(this.startquery&&this.startquery.length){if(query.length>0){query+=" AND "}query+="("+this.startquery+")"}if(arg&&arg.length>0){if(query.length>0){query+=" AND "}query+="("+arg+")"}for(var i=0;i<this.keyElement.length;i++){var name="["+this.keyElement[i].getAttribute("data-arg")+"]";if(name!=inputName){query=K.input2Query(query,name)}}if(!noui&&window.K){crumbs((freeText?"&nbsp;"+this.queryElement.value+"&nbsp;":"")+(rifText?"&nbsp;"+estremiInputEl().value+"&nbsp;":"")+K.crumbs())}return query};function crumbs(x){if(window.K){var o=document.getElementById("breadcrumbs");if(o){o.innerHTML=x}}}Y.query=function(arg,fuzzy){if(!this.locked()){this.fuzzy=fuzzy;var query=this.buildQuery(arg,null,null,null,fuzzy);var hlquery=this.buildHlQuery(arg,null,fuzzy);if(query.length>0){this.load(query,null,hlquery)}}return false};Y.reset=function(o){o.form.reset();K.crumbs("");crumbs("");Y.load(this.startquery);return false};Y.init=function(o){if(o&&o.docsxrow){Y.docsxrow=o.docsxrow}if(o&&o.startquery){Y.startquery=o.startquery}if(o&&o.starthlquery){Y.starthlquery=o.starthlquery}var position=(o&&o.position)?o.position:null;jQuery.each($("*[data-role]",document.body),function(index,elem){var value=elem.getAttribute("data-role");if(value=="keylist"){Y.registerKey(elem)}else{if(value=="dataset"){Y.registerData(elem)}else{if(value=="db"){Y.registerSource(elem)}else{if(value=="content"){}else{if(value=="datasubset"){}else{if(value=="multivaluedcontent"){}else{if(value=="meta"){Y.registerMeta(elem)}else{if(value=="query"){if(Y.queryElement==null){Y.registerQuery(elem)}else{alert("query ignored")}}else{if(value=="startquery"){if(Y.startquery==null){Y.startquery=elem.getAttribute("value")}else{alert('startquery "'+elem.getAttribute("value")+'" ignored')}}else{alert('unknown role:"'+value+'"')}}}}}}}}}});if(window.K){window.K.init()}if(this.startquery!=null){Y.load(this.startquery,position,this.starthlquery)}};window.Y={};window.Y.init=function(o){Y.init(o)};window.Y.reset=function(o){Y.reset(o)};window.Y.buildQuery=function(a,b,c,d){return Y.buildQuery(a,b,c,d)};window.Y.buildHlQuery=function(arg,suggest){return Y.buildHlQuery(arg,suggest)};window.Y.query=function(arg,fuzzy){return Y.query(arg,fuzzy)};window.Y.estremi=function(){return((location.port&&location.port.length)||location.host=="www.3dendless.com")?Y.estremi:Y.estremiIsapi};window.Y.solr=function(){return((location.port&&location.port.length)||location.host=="www.3dendless.com")?Y.solr:Y.solrIsapi};window.Y.db=function(){return Y.db};window.Y.selid=function(){return Y.selid};window.Y.hlSelid=function(){return Y.hlSelid};window.Y.sort=function(){return Y.sort};window.Y.selcount=function(){return Y.selcount};window.Y.locked=function(){return Y.locked()};window.Y.isSelection=function(theInput){return Y.isSelection(theInput)};window.Y.listHiddenFacets=function(){return Y.listHiddenFacets()};window.Y.listVisibleFacets=function(){return Y.listVisibleFacets()};window.Y.removeResizables=function(){removeResizables()};window.Y.insertResizables=function(){insertResizables()};window.Y.parseTemplate=function(c,t,d,p){parseTemplate(c,t,d,p)};window.Y.writeContent=function(d,n,i,p){return writeContent(d,n,i,p)};window.Y.doneWithUpdate=function(s){return doneWithUpdate(s)};window.Y.docStart=function(){return Y.docStart};window.Y.docsxrow=function(q){return Y.docsxrow};window.Y.startquery=function(){return Y.startquery};window.Y.hasSort=function(q){return Y.hasSort(q)};window.Y.updateDocOffset=function(start){return updateDocOffset(start)};window.Y.queryResponse=function(r,s){return Y.queryResponse(r,s)};window.Y.parseDocsResponse=function(r){return parseDocsResponse(r)};window.Y.hl2doc=function(doc,hl){return hl2doc(doc,hl)};$(document).ajaxError(function(e,xhr,settings,exception){consoleLog("error in: "+settings.url+"\nerror:"+exception+"\nstatus:"+xhr.status+"\n\n"+xhr.statusText)})})();function trim(b){return b.replace(/^\s+|\s+$/g,"")}function numFormat(c){if(!window.Intl||!Intl.NumberFormat){return c}var b=new Intl.NumberFormat("it",{style:"decimal"});return b.format(c)}(function(){function ba(bz){return bz.replace(/^\s+|\s+$/g,"")}function bl(bz){return bz==" "||bz=="\r"||bz=="\n"}function bk(bC){var bz="";for(var bA=0;bA<bC.length;bA++){var bB=bC.charAt(bA);if(bA>0&&bl(bB)&&bl(bz.charAt(bz.length-1))){continue}bz+=bB}return bz}function bo(bA,bz){return""+bA+"."+bz}function B(bA,bz){return"data."+bA+"."+bz}function az(bA,bz){return"img."+bA+"."+bz}function aj(bz){bz=ba(bz);if(bz.length>0&&bz.substring(0,1)=='"'&&bz.substring(bz.length-1)=='"'){bz=bz.substring(1);if(bz.length>0){bz=bz.substring(0,bz.length-1);bz=bz.replace(/\\"/g,'"')}}return bz}function aW(bz,bA){aD[bA]=new Array();bz=ba(bz);var bB=aj(bz);if(bz.length>0&&bB!=bz&&bB.length>0){bz=bB;var bC=bz.split('" o "');for(var bF=0;bF<bC.length;bF++){var bE=bC[bF].split('" e "');for(var bD=0;bD<bE.length;bD++){aD[bA][bE[bD]]=""}}}}function a2(bA,bz){return bA}function w(bB,bA){var bz=window.K.key2user(bB,bA);if(bz==bB){return bB}return'<span style="display:none">'+bB+'</span><span class="keyIgnore">'+bz+"</span>"}function aY(b5,bJ,bR,bS){if(!au[bJ.name]){return}var bD=b5.facet_counts.facet_fields[a9(bJ.name)];if(!bD){return}var bZ=null;var bE=bJ.value;if(bE!=""&&bE!=s(bJ)){var bX=bJ.name+"#"+Y.selid();if(!aU[bJ.name]||!aU[bJ.name][bX]){aU[bJ.name]=aU[bJ.name]||[];var cb=Y.buildQuery(null,true,bJ.name,false);$.ajax({type:"POST",url:Y.solr()+"/select?app.facet",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"facet.method=enum&facet.mincount=1&wt=json&indent=off&q="+encodeURI(cb)+"&fl=name&facet=true&facet.limit="+(aG(bJ.name)+1)+"&facet.sort="+v(bJ.name).toLowerCase()+"&facet.field="+encodeURI(a9(bJ.name)),async:true,success:function(ce){aU[bJ.name][bX]=$.parseJSON(ce);aY(b5,bJ,bR,bS)},error:function(cg,cf,ce){alert("update list error: "+ce+", status:"+cg.status)}});return}bZ=[];var bF=b5.facet_counts.facet_fields[a9(bJ.name)];for(var b8=0;b8<bF.length;b8+=2){bZ[bF[b8]]=bF[b8+1]}b5=aU[bJ.name][bX];bD=b5.facet_counts.facet_fields[a9(bJ.name)]}var b0=b5.responseHeader.params["facet.offset"];if(b0==null){b0=0}var ca=b5.responseHeader.params["facet.missing"];if(ca==null){ca=false}var bO=b5.responseHeader.params["facet.limit"];if(bO==null){bO=100}var b9=bD.length/2;var cd=b9;var b3=false;if(ca){cd--}if(cd==bO){cd--;b3=true}var bI="";var bz=false;var bM=bJ.value;var b7=false;var cc=bM.length>0;var bL=bR.toLowerCase();var bN=bM.toLowerCase();var bK=bM.length;aW(bJ.value,bJ.name);var bB="";var bT="&nbsp;";if(W(bJ.name)<ag(bJ.name)-1){bT+="&#43;&nbsp;"}bT='<td nowrap width="1%" style="border:solid 1px #eee;border-top:0;border-right:0;" valign="top">'+bT+"</td>";var b2=v(bJ.name)=="FALSE";var bC=-1;for(var bG=0;bG<cd*2;bG+=2){var bV=bG/2+1;var bP=b2?cd*2-bG-2:bG;var b1=bD[bP];var b4=bD[bP+1];b7=aD[bJ.name][b1]!=null;if(b7&&bC<0){bC=bV}if(cc){bz=b7||(b1.length>=bK&&b1.substring(0,bK).toLowerCase()==bN)}bB+='<tr role="button" tabindex="0" onkeydown="if(event&&event.keyCode==13)$(this).click();" id="'+bo(bV,bJ.name)+'" class="idxRow" onclick="return K.keyListChange(event,\''+bV+"','"+bJ.name+'\')" style="'+(bz?"background-color:"+bb+";":"")+(bZ?(bZ[b1]?"":"opacity:.5;"):"")+'">'+bT+'<td class="idxRow rowb" valign="bottom" id="'+B(bV,bJ.name)+'">'+w(b1,bJ.name)+'</td><td class="idxNum rowbr" valign="bottom" align="right">'+numFormat(b4)+"&#160;</td></tr>"}if(bB!=""){l(bJ.name,b0);aF[bJ.name]=cd;f[bJ.name]=bR;R[bJ.name]=bJ.name;var bW=U[bJ.name];var bQ=A[bJ.name];var bU=bW?n(bJ):av(bJ);var b6=bW?O(bJ):q(bJ);if(!b6){b6=bU}e(bJ,bW);var bA=b0>0?'<tr class="idxRow" style="height:'+aA+'px;"><td class="idxRow rowlbr" colspan="3"><div id="keylist'+bJ.name+'Top"    onclick="return    K.fillListAtTop(event,\''+bJ.name+"')\" onmouseover=\"this.style.backgroundColor='"+t+'\'" onmouseout="this.style.backgroundColor=\'#eedddd\'" class="idxRow" style="background-color:#eedddd;font-size:8px;width:100%"><center><img border="0" src="pix/arrow_up.gif"  ></center></div></td></tr>':"";var bH=b3?'<tr class="idxRow" style="height:'+aA+'px;"><td class="idxRow rowlbr" colspan="3"><div id="keylist'+bJ.name+'Bottom" onclick="return K.fillListAtBottom(event,\''+bJ.name+"')\" onmouseover=\"this.style.backgroundColor='"+t+'\'" onmouseout="this.style.backgroundColor=\'#eedddd\'" class="idxRow" style="background-color:#eedddd;font-size:8px;width:100%"><center><img border="0" src="pix/arrow_down.gif"></center></div></td></tr>':"";bI='<table border="0" class="facetContent" cellspacing="0" cellpadding="0"><tbody>'+bA+bB+bH+"</tbody></table>";if(b6){b6.innerHTML=bI}else{bU.innerHTML=bI}bU.style.display="";var bY=aB(bJ.name);bY=bY?bY:1;bY=bY>1?bY:(bC>=0?bC:bY);an(bY,bJ.name,bS&&bS>0?false:true,bS&&bS>0?true:false,false,true)}else{r(bJ.name,true)}}function aQ(bB){var bA=bB.name;var bE=bB.value;if(bE==""){return}var bF=null;var bD=-1;for(var bz=aB(bA);bz>0&&bz<=aF[bA];bz++){var bC=ba(aK(document.getElementById(B(bz,bA))));if(bC.toLowerCase().indexOf(bE.toLowerCase())==0){bD=bz;break}}for(var bz=1;bD==-1&&bz>0&&bz<=aB(bA);bz++){var bC=ba(aK(document.getElementById(B(bz,bA))));if(bC.toLowerCase().indexOf(bE.toLowerCase())==0){bD=bz;break}}if(bD>=0){an(bD,bA,true)}}function aK(bC,bz){bz=bz?bz:"";for(var bB=0;bC&&bB<bC.childNodes.length;bB++){var bA=bC.childNodes[bB];if(bA.nodeType==3){bz+=bA.nodeValue}if(bA.nodeType==1&&!($(bA).attr("class").indexOf("keyIgnore")>=0)){bz+=aK(bA)}}return bz}function ae(bA,bz){var bB=document.getElementById(B(bA,bz));if(!bB){bB=document.getElementById(bo(bA,bz))}return ba(aK(bB))}function a4(bB,bz){if(bB){bB.cancelBubble=true;bB.returnValue=false}var bD=i(bz);l(bz,bD-aG(bz)/2);if(i(bz)<0){l(bz,0)}ai(bz,bD-i(bz));var bA=S(bz);var bC=s(bA);at(bC,bA,-1);return false}function be(bB,bz){if(bB){bB.cancelBubble=true;bB.returnValue=false}l(bz,i(bz)+aF[bz]/2);ai(bz,aF[bz]/2+1);var bA=S(bz);var bC=s(bA);at(bC,bA,1);return false}function s(bz){var bA=bz.value;if(Y.isSelection(bA)){bA=""}return bA}function m(bz,bB){var bA=bd[bz];if(!bA){bA=""}if(bA!=bB){bd[bz]=bB;l(bz,0)}}function aq(bz){var bA=S(bz);var bB=s(bA);m(bA.name,bB);at(bB,bA,0)}function aN(bz){return(bz.substring(0,1)=="["?bz.substring(1,bz.length-1):bz)}function a9(bA){var bz=aN(bA);bz=bz.split(",");if(bz.length>0){bz=bz[W(bA)]}return bz}function a6(bz,bC,bD,bA){var bB=jQuery.parseJSON(bz);if(bB.error){alert(bB.error)}else{aY(bB,bC,bD,bA)}}function at(bC,bA,bz){au[bA.name]=true;$.ajax({type:"POST",url:Y.solr()+"/select?app.facet",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"&facet.offset="+i(bA.name)+"&facet.limit="+(aG(bA.name)+1)+"&facet.sort="+v(bA.name).toLowerCase()+"&facet.prefix="+encodeURI(bC)+"&facet.method=enum&facet.mincount=1&wt=json&indent=off&q="+encodeURI(Y.buildQuery())+"&fl=name&facet=true&facet.field="+encodeURI(a9(bA.name)),success:function(bD){a6(bD,bA,bC,bz)},error:function(bF,bE,bD){alert("update list error: "+bD+", status:"+bF.status)}});if(A[bA.name]){try{bA.focus()}catch(bB){}}return false}function am(bz,bD,bE){var bA=jQuery.parseJSON(bz);if(bA.error){alert(bA.error)}else{bD=bD.split(";");bE=bE.split(";");for(var bC=0;bC<bD.length;bC++){var bB="["+bD[bC]+"]";aY(bA,S(bB),bE[bC],0)}}}function bv(bE,bA){attributeNamesArray=bE.split(";");var bG="";for(var bC=0;bC<attributeNamesArray.length;bC++){var bB="["+attributeNamesArray[bC]+"]";var bD=S(bB);au[bD.name]=true;var bF=s(bD);m(bD.name,bF);if(bC>0){bG+=";"}bG+=bF}inputValuesArray=bG.split(";");var bz="";for(var bC=0;bC<attributeNamesArray.length;bC++){var bB="["+attributeNamesArray[bC]+"]";bz+="&facet.limit="+(aG(bB)+1)+"&facet.sort="+v(bB).toLowerCase()+"&facet.prefix="+encodeURI(inputValuesArray[bC])+"&facet.field="+encodeURI(a9(bB))}$.ajax({type:"POST",url:Y.solr()+"/select?app.facet",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"facet.method=enum&facet.mincount=1&wt=json&indent=off&q="+encodeURI(Y.selid())+"&fl=name&facet=true"+bz,success:function(bH){am(bH,bE,bG);if(bA){bA()}},error:function(bJ,bI,bH){alert("list update error: "+bH+", status:"+bJ.status);if(bA){bA()}}})}function W(bz){return bc[bz]?bc[bz]:0}function v(bz){return p[bz]?p[bz]:"true"}function aG(bz){return a1[bz]?a1[bz]:H}function i(bz){return ay[bz]?ay[bz]:0}function aB(bz){return a7[bz]?a7[bz]:0}function x(bA,bz){bc[bA]=bz}function bs(bz,bA){p[bz]=bA}function aX(bz,bA){a1[bz]=parseInt(bA)}function l(bz,bA){ay[bz]=parseInt(bA)}function ai(bz,bA){a7[bz]=parseInt(bA)}function V(bA){var bz=v(bA);if(bz=="true"){bs(bA,aP[bA]?aP[bA]:"false")}else{bs(bA,"true")}l(bA,0);aq(bA);try{S(bA).focus()}catch(bB){}return false}function ab(){var bD=Y.listVisibleFacets();var bz=""+Math.floor(100/bD.length)+"%";for(var bB=0;bB<bD.length;bB++){var bA=S("["+bD[bB][0]+"]");z(bA);bp(bA).style.width=bz}var bC=Y.listHiddenFacets();for(var bB=0;bB<bC.length;bB++){var bA=S("["+bC[bB][0]+"]");bp(bA).style.width=bz}for(var bB=0;bB<bD.length;bB++){var bA=S("["+bD[bB][0]+"]");e(bA,false)}}function E(bz){var bA=Y.listVisibleFacets();if(bA.length==1){return}Y.removeResizables();bp(S(bz)).style.display="none";ab();Y.insertResizables()}function S(bz){return document.forms[0][bz]}function n(bz){return document.getElementById("keylistFloating"+bz.name)}function O(bz){return document.getElementById("keylistFloatingContent"+bz.name)}function av(bz){return document.getElementById("keylist"+bz.name)}function ah(bz){return document.getElementById("keylistContainer"+bz.name)}function q(bz){return document.getElementById("keylistContent"+bz.name)}function aw(bz){return document.getElementById("keylistHeaderContent"+bz.name)}function bh(bz){return document.getElementById("keylistHeaderContainer"+bz.name)}function a5(bz){return document.getElementById("keylist"+bz.name+"Top")}function ao(bz){return document.getElementById("keylist"+bz.name+"Bottom")}function bp(bz){return av(bz).parentNode.parentNode}var M=24;var ac=8;var aA=15;var H=256;function aO(bA){var bz=bA.offsetLeft;var bB=bA.offsetParent;while(bB!=null){bz+=bB.offsetLeft;bB=bB.offsetParent}return bz}function aJ(bA){var bz=bA.offsetTop;var bB=bA.offsetParent;while(bB!=null){bz+=bB.offsetTop;bB=bB.offsetParent}return bz}function e(bA,bH){var bE=A[bA.name];var bJ=bH?M:ac;var bF=aF[bA.name];var bz=bH?n(bA):av(bA);var bB=bH?O(bA):q(bA);if(!bB){bB=bz}var bC=0;var bD=0;var bG=0;var bI=0;if(bH||bE){bG-=6;bI-=7+8;bD+=2*(-bI)}bz.style.top=(bG+parseInt(aJ(bA))+parseInt(bA.offsetHeight))+"px";bz.style.left=(bI+aO(bA))+"px";if(bH){bz.style.width=(bD+parseInt(bA.offsetWidth))+"px";if(parseInt(av(bA).offsetHeight)/aA>bJ){bJ=(parseInt(av(bA).offsetHeight)/aA)+1}if(bJ>aF[bA.name]){bJ=aF[bA.name]}bB.style.height=""+(bC+bJ*aA)+"px"}else{ah(bA).style.width="100%";q(bA).style.width="100%"}}function aR(bD,bA){var bC=n(bD);var bF=O(bD);if(!bF){bF=bC}var bz=av(bD);var bE=q(bD);if(!bE){bE=bz}if(!bA){bE.innerHTML=bF.innerHTML;bF.innerHTML="";if($.browser.msie){bC.style.display="none"}else{$(bC).fadeOut()}}else{e(bD,bA);bF.innerHTML=bE.innerHTML;bE.innerHTML="";if($.browser.msie){bC.style.display=""}else{$(bC).fadeIn()}}var bB=document.getElementById(bo(aB(bD.name),bD.name));if(bB){D(bB,false)}}function C(bz){if(U[bz.name]){return false}for(var bA in R){if(U[bA]){z(S(bA))}}aR(bz,true);U[bz.name]=true;return false}function z(bz){if(!U[bz.name]){return false}aR(bz,false);U[bz.name]=false;return false}function u(bz){if(U[bz.name]){z(bz)}else{C(bz)}try{bz.focus()}catch(bA){}return false}function bq(bz,bA){u(S(bA));return false}function aM(bz){var bB=false;if(!U[bz.name]){for(var bA in R){if(bA!=bz.name){if(U[bA]){z(S(bA));bB=true}}}}if(bB){C(bz)}else{}try{bz.focus()}catch(bC){}return false}function bg(bz){return false}function a8(){for(name in R){l(name,0);ai(name,0)}Y.query()}function y(bH,bE){document.getElementById("hiddenFacetMenu").style.display="none";var bA=S(bH);var bD=S(bE);var bI=aJ(ah(bA))-aJ(bh(bA));var bG=q(bA).offsetHeight;var bB=ah(bA).offsetHeight;Y.removeResizables();var bN=av(bA).parentNode;var bC=av(bD).parentNode;var bz=bC.parentNode;z(bA);var bF=$(bN).replaceWith($(bC));$(bz).append($(bF));Y.insertResizables();var bL=aJ(ah(bD))-aJ(bh(bD));var bK=q(bD).offsetHeight;var bM=ah(bD).offsetHeight;q(bD).style.height=""+(bG-(bL-bI))+"px";ah(bD).style.height=""+(bB-(bL-bI))+"px";a8();try{bD.focus()}catch(bJ){}return false}function T(bI,bB){document.getElementById("hiddenFacetMenu").style.display="none";Y.removeResizables();$(bp(S(bB))).insertAfter($(bp(S(bI))));bp(S(bB)).style.display="";ab();var bz=S(bI);var bG=S(bB);var bE=aJ(ah(bz))-aJ(bh(bz));var bJ=q(bz).offsetHeight;var bF=ah(bz).offsetHeight;var bA=av(bz).parentNode;var bL=av(bG).parentNode;var bD=aJ(ah(bG))-aJ(bh(bG));var bC=q(bG).offsetHeight;var bK=ah(bG).offsetHeight;q(bG).style.height=""+(bJ-(bD-bE))+"px";ah(bG).style.height=""+(bF-(bD-bE))+"px";Y.insertResizables();a8();try{bG.focus()}catch(bH){}return false}function aE(bI,bG,bB){var bF="";var bA=document.getElementById("hiddenFacetMenu");var bz=document.getElementById("hiddenFacetContent");for(var bD=0;bD<bI.length;bD++){bF+="<div onmouseover=\"this.style.backgroundColor='"+t+'\';" onmouseout="this.style.backgroundColor=\'\';" class="keylist keymenutitle" style="cursor:pointer;" onclick="'+bB+"('"+bG+"','["+bI[bD][0]+"]');\">&nbsp;"+bI[bD][1]+"</div>"}bz.innerHTML=bF;var bC=0;var bE=0;var bH=-14;var bK=2;if($.browser.msie){bK-=6;bH-=0}var bJ=S(bG);bA.style.top=(bH+parseInt(aJ(bJ)))+"px";bA.style.left=(bK+aO(bJ))+"px";bA.style.width=(bE+parseInt(bJ.offsetWidth))+"px";bA.style.display=""}function aC(bA){var bz=Y.listHiddenFacets();if(bz.length==1){y(bA,"["+bz[0][0]+"]")}else{aE(bz,bA,"K.doReplaceFacet")}return false}function N(bz){var bA=Y.listHiddenFacets();if(bA.length==1){T(bz,"["+bA[0][0]+"]")}else{aE(bA,bz,"K.doAddFacet")}return false}function h(bC,bD,bB){if(Y.isSelection(bB)){if(bC.length>0){bC+=" AND "}var bA=bB.split('" o "');if(bA.length>1){bC+="("}for(var bz=0;bz<bA.length;bz++){if(bz>0){bC+='" OR '}bC+=bD+":";if(bz>0){bC+='"'}bC+=bA[bz]}if(bA.length>1){bC+=")"}}return bC}function ad(bC,bA){var bB=ba(S(bA).value);var bD=a9(bA);bC=h(bC,bD,bB);var bz=W(bA);while(bz--){bC=h(bC,al(bz,bA),bn(bz,bA))}return bC}function aa(bz){var bA=ba(S(bz).value);if(Y.isSelection(bA)){return aj(bA)}return""}function c(bz){return aN(bz).split(",")}function al(bA,bz){return c(bz)[bA]}function L(bB,bA){var bC=al(bB,bA);var bz=X[bC];return bz[bB]}function aS(bB,bA,bC){var bz=X[bA];if(bz==null){X[bA]=new Array()}X[bA][bB]=bC}function bn(bA,bz){return(X[bz]&&X[bz].length>bA?X[bz][bA]:"")}function ag(bz){return c(bz).length}var bc=new Array();var X=new Array();var bd=new Array();var U=new Array();var au=new Array();var a7=new Array();var aF=new Array();var f=new Array();var R=new Array();var A=new Array();var aD=new Array();var p=new Array();var aP=new Array();var a1=new Array();var ay=new Array();var aU=new Array();var aH=0;function aT(bz){aH+=bz?1:-1}function J(){return aH>0}function r(bz,bC){var bB=av(S(bz));var bD=A[bz];f[bz]="";aD[bz]=new Array();ay[bz]=0;if(bD||bC){z(S(bz));au[bz]=false;var bA=q(S(bz));if(bA){bA.innerHTML=""}else{bB.innerHTML=""}if(bD){bB.style.display="none"}aF[bz]=0;ai(bz,0)}else{aq(bz)}return true}function bj(bB){var bz=new Array();bB=bB.split('" o "');for(var bA=0;bA<bB.length;bA++){if(bB[bA].length>0){if(bA==0&&bB[bA].substring(0,1)=='"'){bB[bA]=bB[bA].substring(1)}if(bA==bB.length-1&&bB[bA].substring(bB[bA].length-1,bB[bA].length)=='"'){bB[bA]=bB[bA].substring(0,bB[bA].length-1)}bz[bB[bA].replace(/\\"'/g,'"')]=""}}return bz}function aV(bA){var bz="";for(var bB in bA){if(bA[bB]!=null){if(bz.length>0){bz+=" o "}bz+='"'+bB.replace(/"/g,'\\"')+'"'}}return bz}var bf="";function o(bz){if(bz||bz==""){bf=bz}return bf}function ax(bz,bB){var bA=S(bz);if(bB){aD[bz][bB]=null}bA.value=aV(aD[bz]);bf=bf.replace("&nbsp;"+aj(bB)+"&nbsp;","");try{bA.focus()}catch(bC){}}function ap(bz,bB){var bA=S(bz);if(bB){aD[bz][bB]=""}bA.value=aV(aD[bz]);bf+="&nbsp;"+aj(bB)+"&nbsp;";try{bA.focus()}catch(bC){}}function b(bC,bA,bz){var bB=ae(bA,bz);if(aD[bz][bB]!=null){ax(bz,bB)}else{ap(bz,bB)}if(bA!=aB(bz)){F(bA,bz)}bC.cancelBubble=true;bC.returnValue=false;return false}function Q(bC,bA,bz){var bB=ae(bA,bz);an(bA,bz);ap(bz,bB);if(A[bz]){r(bz)}bC.cancelBubble=true;bC.returnValue=false;return false}function a3(bG){var bJ=S(bG);var bH=W(bG);var bD=aw(bJ);var bz=bh(bJ);var bB=q(bJ);var bL=ah(bJ);var bI=aJ(bL)-aJ(bz);var bK=bB.offsetHeight;var bM=bL.offsetHeight;bD.innerHTML="";var bF="";for(var bE=0;bE<bH;bE++){bF+='<div style="cursor:pointer; border:solid 1px #eee;border-top:0;" onclick="K.popInputField(\''+bG+"',"+bE+')">';for(var bC=0;bC<=bE;bC++){bF+="&nbsp;"}bF+='<span style="font-style:bold;">&#45;</span>&nbsp;'+aj(bn(bE,bG))+"</div>"}bD.innerHTML=bF;if($.browser.msie){if(bF==""){bD.style.display="none"}else{bD.style.display=""}}var bA=aJ(bL)-aJ(bz);bB.style.height=""+(bK-(bA-bI))+"px";bL.style.height=""+(bM-(bA-bI))+"px"}function k(bB){var bA=S(bB);var bz=W(bB);aS(bz,bB,bA.value);bA.value="";x(bB,++bz);aS(bz,bB,"");a3(bB);l(bB,0)}function bx(bA,bB){var bz=bj(bB);for(bB in bz){ax(bA,bB)}}function g(bB,bA,bC){var bE=S(bB).value;if(bE&&bE.length>0){bx(bB,bE)}var bz=W(bB);for(var bD=bz;bD>=bA;bD--){var bE=bn(bD,bB);if(bE&&bE.length>0){ax(bB,aj(bE))}aS(bD,bB,"")}z(S(bB));x(bB,bA);a3(bB);l(bB,0);if(!bC){a8()}return false}function G(bD,bB,bA,bC){if(Y.locked()){bD.cancelBubble=true;bD.returnValue=false;return false}var bz=bC(bD,bB,bA);ai(bA,0);z(S(bA));if(W(bA)<ag(bA)-1&&aD[bA][ae(bB,bA)]!=null){k(bA)}a8();return bz}function P(bz,bA){return bA.length>0&&bz.length>=bA.length&&bz.substring(0,bA.length).toLowerCase()==bA.toLowerCase()}var t="#ddd";var bb="#f0f0f0",I="#ffffff",a0="#f0f0f0";function ak(bz){return bz?bb:"#FEFEFE"}function F(bA,bz){var bB=document.getElementById(bo(bA,bz));if(bB){var bD=ae(bA,bz);var bC=P(bD,S(bz).value)||aD[bz][bD]!=null;bB.style.backgroundColor=ak(bC)}}function d(bE,bz,bC){if(aB(bz)>0){F(aB(bz),bz)}var bB=false;if(bC!=null){var bA=aD[bz];if(bA){var bD=ae(bC,bz);bB=bA[bD]!=null}}bE.style.backgroundColor=bB?a0:I}function ar(bz){return bz.parentNode.parentNode.parentNode}function D(bB,bz){var bA=bB.offsetTop;if(bz){bA+=bB.offsetHeight-ar(bB).offsetHeight}ar(bB).scrollTop=bA}function by(bC,bA,bB,bz){d(bC,bA);D(bC,bz);bC.onclick()}function an(bI,bG,bH,bz,bE,bD){var bJ=S(bG);var bA=1;if(bI<bA){var bB=a5(bJ);if(bB){by(bB,bG,bH,bz);return}bI=bA}if(bI>aF[bG]){var bB=ao(bJ);if(bB){by(bB,bG,bH,bz);return}bI=aF[bG]}var bC=document.getElementById(bo(bI,bG));if(bC){d(bC,bG,bI);ai(bG,bI);if((!bE&&(bH||bz))||bC.offsetTop<ar(bC).scrollTop||bC.offsetTop+bC.offsetHeight>ar(bC).scrollTop+ar(bC).offsetHeight){D(bC,bz);if(!bD){try{bJ.focus()}catch(bF){}}}}}function aL(bz,bA){an(aB(bz)-bA,bz,true,false,true)}function bm(bz,bA){an(aB(bz)+bA,bz,false,true,true)}function br(bz){}function bi(bz){}function aZ(bz){if(!A[bz]){return true}var bA=av(S(bz));return bA&&!(bA.style.display=="none")}var aI=0;function Z(bA,bz){if(aZ(bz.name)){if(!bA.timeStamp||bA.timeStamp!=aI){switch(bA.keyCode){case 13:window.K.keyListChange(bA,aB(bz.name),bz.name);bA.cancelBubble=true;bA.returnValue=false;break;case 33:aL(bz.name,10);bA.cancelBubble=true;bA.returnValue=false;break;case 34:bm(bz.name,10);bA.cancelBubble=true;bA.returnValue=false;break;case 35:if(bA.ctrlKey){bm(bz.name,aF[bz.name]-aB(bz.name));bA.cancelBubble=true;bA.returnValue=false}break;case 36:if(bA.ctrlKey){aL(bz.name,aB(bz.name)-1);bA.cancelBubble=true;bA.returnValue=false}break;case 38:aL(bz.name,1);bA.cancelBubble=true;bA.returnValue=false;break;case 40:bm(bz.name,1);bA.cancelBubble=true;bA.returnValue=false;break;default:}aI=bA.timeStamp}else{switch(bA.keyCode){case 35:case 36:if(!bA.ctrlKey){break}case 33:case 34:case 38:case 40:bA.cancelBubble=true;bA.returnValue=false;break;default:}}}return true}function bw(bA,bz){return Z(bA,bz)}function af(bA,bz){return Z(bA,bz)}function bu(bC,bB){var bA=false;var bz=bC.altKey||bC.ctrlKey;if(aZ(bB.name)){switch(bC.keyCode){case 8:if(bB.value==""){r(bB.name);bA=true}break;case 9:if((A[bB.name]||U[bB.name])&&!(bC.altKey||bC.ctrlKey)){r(bB.name)}bA=true;break;case 13:bC.cancelBubble=true;bC.returnValue=false;case 16:case 17:case 18:bA=true;break;case 27:z(bB);bC.cancelBubble=true;bC.returnValue=false;bA=true;break;case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:bC.cancelBubble=true;bC.returnValue=false;bA=true;break;default:}}else{switch(bC.keyCode){case 8:if(bB.value!=""){break}case 9:case 16:case 17:case 18:case 13:case 27:case 35:case 36:case 37:case 39:bA=true;break;default:}}if(!bA&&!bz){aq(bB.name)}return true}window.K={};window.K.init=function(){Y.openKeyLists=bv};var bt=function(bD){var bA=bD.split(" ");window._accessKeys=window._accessKeys||"";for(var bC=0;bC<bA.length;bC++){var bB=bA[bC].substring(0,1).toLowerCase();if(bA[bC].length&&_accessKeys.indexOf(bB)<0){_accessKeys=_accessKeys+bB;bA[bC]='<span class="accesskey">'+bA[bC].substring(0,1)+"</span>"+bA[bC].substring(1);return{k:bB,l:bA.join(" ")}}}for(var bC=0;bC<bA.length;bC++){for(var bz=1;bz<bA[bC].length;bz++){var bB=bA[bC].substring(bz,bz+1).toLowerCase();if(_accessKeys.indexOf(bB)<0){_accessKeys=_accessKeys+bB;bA[bC]=bA[bC].substring(0,bz)+'<span class="accesskey">'+bA[bC].substring(bz,bz+1)+"</span>"+bA[bC].substring(bz+1);return{k:bB,l:bA.join(" ")}}}}return{l:bD}};window.K.registerKey=function(bD,bB,bA,bF){A[bB]=bF;var bC=bD.getAttribute("data-sort");if(!bC||bC.toLowerCase()!="false"){bC="true"}else{aP[bB]=bC}bs(bB,bC);var bz=bD.getAttribute("data-height");if(!bz||bz==""){bz="auto"}var bE=bt(bA);bD.innerHTML=bF?'<table style="width:100%;" border="0"><tr><td align="right" width="10%" nowrap="nowrap"><a class="keylist keytitle" title="elenco '+bA+'" href="javascript:void(0)" tabindex="-1" '+(bE.k?'accesskey="'+bE.k+'" ':"")+"onclick=\"K.openFullList('"+bB+"');return false\">"+bE.l+'</a></td><td><input class="keylist" style="width:100%; border:solid 1px #eee;" name="'+bB+'" value="" type="text" ondblclick="K.openFullList(\''+bB+'\');return false" autocomplete="off" onclick="return K.closeKeyList(\''+bB+'\')" onkeypress="return K.keyListKeyPress(event,this)" onkeyup="return K.keyListKeyUp(event,this)" onkeydown="return K.keyListKeyDown(event,this)"/></td></tr></table>':'<a tabindex="-2" onclick="$(this).next().focus();" name="'+bA+'" '+(bE.k?'accesskey="'+bE.k+'" ':"")+'></a><a class="keylist keytitle" tabindex="0" style="text-decoration:none" href="javascript:void(0)" onclick="return K.changeSort(\''+bB+'\')" title="cambia ordinamento" aria-label="cambia ordinamento '+bA+'" >'+bE.l+'</a><input name="'+bB+'" id="'+bB+'" value="" type="text" style="display:none" title="'+bA+'" /><div id="keylist'+bB+'" class="keylist" ><div id="keylistContainer'+bB+'" style="width:100%;"><div class="keyListContainer" style="position:relative; left:0px; top:0px; border-top:solid 1px #ededed; border-bottom:solid 1px #ededed;"><div id="keylistContent'+bB+'" style="overflow:auto; height:'+bz+';" onscroll="try{document.forms[0][\''+bB+"'].focus();}catch(e){;}\"></div></div></div></div>";if(bF){jQuery('<div id="keylist'+bB+'" style="text-align:left; display:none;z-index:100;position:absolute;padding:2px;background-color:transparent;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;"><div style="padding:0.3em;background-color:white;border:solid 1px #c0c0a0;-moz-box-shadow:0px 0px 8px #aaa;-webkit-box-shadow:0px 0px 8px #aaa;box-shadow:0px 0px 8px #aaa;"><div style="position:relative; left:0px; top:0px; background-color:#FEFEFE;width:100%;overflow:auto;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;" id="keylistContent'+bB+'" onscroll="try{document.forms[0][\''+bB+"'].focus();}catch(e){;}\"></div></div></div>").appendTo("body")}else{jQuery('<div id="keylistFloating'+bB+'" style="text-align:left; display:none;z-index:100;position:absolute;padding:2px;background-color:transparent;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;"><div style="padding:0.3em;background-color:white;border:solid 1px #c0c0a0;-moz-box-shadow:0px 0px 8px #aaa;-webkit-box-shadow:0px 0px 8px #aaa;box-shadow:0px 0px 8px #aaa;"><div style="position:relative; left:0px; top:0px; background-color:#FEFEFE;width:100%;overflow:auto;-moz-box-sizing: border-box;-ms-box-sizing: border-box;-webkit-box-sizing: border-box;" id="keylistFloatingContent'+bB+'" onscroll="try{document.forms[0][\''+bB+"'].focus();}catch(e){;}\"></div></div></div>").appendTo("body")}};window.K.openFullList=function(bz){return aq(bz)};window.K.keyListKeyPress=function(bA,bz){return bw(bA,bz)};window.K.keyListKeyUp=function(bA,bz){return bu(bA,bz)};window.K.keyListKeyDown=function(bA,bz){return af(bA,bz)};window.K.closeKeyList=function(bz,bA){return r(bz,bA)};window.K.keyListChange=function(bB,bA,bz){return G(bB,bA,bz,A[bz]?Q:b)};window.K.fillListAtBottom=function(bA,bz){return be(bA,bz)};window.K.fillListAtTop=function(bA,bz){return a4(bA,bz)};window.K.changeSort=function(bz){return V(bz)};window.K.closeFacet=function(bz){return E(bz)};window.K.keyListFocus=function(bz){return aM(bz)};window.K.keyListBlur=function(bz){return bg(bz)};window.K.toggleFloating=function(bz,bA){return bq(bz,bA)};window.K.keyListExpand=function(bz){return C(bz)};window.K.keyListToggle=function(bz){return u(bz)};window.K.replaceFacet=function(bz){return aC(bz)};window.K.addFacet=function(bz){return N(bz)};window.K.doReplaceFacet=function(bA,bz){return y(bA,bz)};window.K.doAddFacet=function(bA,bz){return T(bA,bz)};window.K.input2Query=function(bA,bz){return ad(bA,bz)};window.K.input2Crumb=function(bz){return aa(bz)};window.K.crumbs=function(bz){return o(bz)};window.K.popInputField=function(bA,bz,bB){return g(bA,bz,bB)};window.K.key2user=function(bA,bz){return a2(bA,bz)}})();(function(){var e=[];var s=[];var D=2;var f="estremiItem_";var r=[];var q=0;var d=0;var ab=24;var g="";var w=null;var Z="estremiListContainerId";function z(ae,af){return af+"@"+ae}function m(){return document.getElementById(Z)}function X(ae){return ae?"fakefield":null}function b(ae){return ae?["fakefield"]:null}function ac(ae){return ae?"fakedb":null}function R(){return ac(w)}function v(){return w}function u(){return document.forms["z-form"][v()]}function C(){return X(v())}function W(){return s[z(R(),C())]}function I(ae,af,ag){s[z(af,ag)]=ae.split("\n")}function O(ae){if(window.console&&window.console.log){console.log(ae)}}function n(al,ai){var ae=" OR ";var ak=al.split(ae);var am=function(aq){var av=[],au=[];for(var at=0;at<aq.length;at++){av[at]=0}for(var ap=false;!ap;){var ao="";for(var at=0;at<aq.length;at++){ao+=aq[at][av[at]]+(ai?"~":"")}au.push(ao);av[aq.length-1]++;for(var at=aq.length-1;at>=0;at--){if(av[at]==aq[at].length){if(at==0){ap=true;break}for(var ar=at;ar<aq.length;ar++){av[ar]=0}av[at-1]++}}}return au};var aj=function(ap){var ao=[];var aq=0;for(;;){var at=ap.indexOf("{",aq);if(at<0){if(aq<ap.length){ao.push([ap.substring(aq,ap.length)])}break}if(at!=aq){ao.push([ap.substring(aq,at)])}var ar=ap.indexOf("}",at);if(ar<0){O('wrong brace match in "'+ap+'"');ao.push([ap.substring(at)]);break}aq=ar+1;ao.push(ap.substring(at+1,ar).split(","))}return am(ao)};for(var ah=0;ah<ak.length;ah++){var af=aj(ak[ah]);for(var ag=0;ag<af.length;ag++){ak.splice(ah,ag?0:1,af[ag])}ah+=af.length-1}var an="";for(var ah=0;ah<ak.length;ah++){if(ah>0){an+=ae}an+='"'+ak[ah]+'"~8'}return an}var P=[];function o(ag){var af=u();if(!af){return null}var ah=trim(af.value);if(ah==""){return null}var ae=P[ag+"@"+ah];if(ae){return ae}$.ajax({type:"GET",url:Y.estremi()+"?wat="+encodeURIComponent(ah),async:false,success:function(ai){ae=n(ai,ag);P[ag+"@"+ah]=ae},error:function(ak,aj,ai){alert("load list error: "+ai+", status:"+ak.status)}});return ae}function L(ae,af,ah,ag){$.ajax({type:"GET",url:Y.estremi()+"?wat=list",async:true,success:function(ai){var aj=ag||[];aj.unshift(ai);ah.apply(undefined,aj)},error:function(ak,aj,ai){alert("load list error: "+ai+", status:"+ak.status)}})}function k(ag){var af=ac(ag.name);var ae=b(ag.name);for(var ah=0;ah<ae.length;ah++){e[z(af,ae[ah])]={db:af,field:ae[ah]}}if(ag.addEventListener){ag.addEventListener("keyup",function(aj){return G(aj,ag.name)},false)}else{if(ag.attachEvent){ag.attachEvent("onkeyup",function(aj){return G(aj,ag.name)})}}if(ag.addEventListener){ag.addEventListener("keydown",function(aj){return t(aj,ag.name)},false)}else{if(ag.attachEvent){ag.attachEvent("onkeydown",function(aj){return t(aj,ag.name)})}}if(ag.addEventListener){ag.addEventListener("dblclick",function(aj){return B(aj,ag.name)},false)}else{if(ag.attachEvent){ag.attachEvent("ondblclick",function(aj){return B(aj,ag.name)})}}if(ag.addEventListener){ag.addEventListener("focus",function(aj){return H(aj,ag.name)},false)}else{if(ag.attachEvent){ag.attachEvent("onfocus",function(aj){return H(aj,ag.name)})}}if(ag.addEventListener){ag.addEventListener("blur",function(aj){return i(aj,ag.name)},false)}else{if(ag.attachEvent){ag.attachEvent("onblur",function(aj){return i(aj,ag.name)})}}if(window.addEventListener){window.addEventListener("resize",function(aj){return J(aj)},false)}else{if(window.attachEvent){window.attachEvent("onresize",function(aj){return J(aj)})}}var ai=document.getElementById("estremiHints");if(ai){ag.title=ai.innerHTML}}function U(ae,ag,af){I(ae,e[ag[af]].db,e[ag[af]].field);if(++af<ag.length){L(e[ag[af]].db,e[ag[af]].field,function(ah,aj,ai){U(ah,aj,ai)},[ag,af])}}function Q(){var af=document.getElementsByTagName("head")[0];var ag=document.createElement("style");var ai=document.createTextNode(".estremiListContainer { position:absolute;overflow:auto; border:solid 1px #ddd; z-index:9999;  font-size:80%; font-family:Verdana,Helvetica,Arial,Sans-Serif;  box-shadow:2px 4px 12px #888; background-color:white; }\n.estremiListList { margin:0px; padding:"+D+"px; list-style-type:none; }\n.estremiListItem { padding-left:12px; text-indent:-10px; cursor:pointer; text-align:left; }\n");ag.type="text/css";if(ag.styleSheet){ag.styleSheet.cssText=ai.nodeValue}else{ag.appendChild(ai)}af.appendChild(ag);var aj=document.createElement("div");aj.innerHTML='<div id="'+Z+'" tabindex="1" class="estremiListContainer" style="display:none;" onfocus="estremiInputEl().focus();" onscroll="estremiInputEl().focus();"></div>';var ae=document.getElementsByTagName("body")[0];ae.appendChild(aj);k(document.forms["z-form"]["estremi"]);var ah=[];for(key in e){ah.push(key)}if(ah.length>0){L(e[ah[0]].db,e[ah[0]].field,function(ak,am,al){U(ak,am,al)},[ah,0])}}function H(af,ae){w=ae}function ad(){m().style.display="none"}function i(){setTimeout(function(){if(!document.activeElement||document.activeElement.name!=v()){ad()}},100)}function p(ah,ag){ah=trim(ah);var ae="";for(var af=0;af<ah.length;af++){var ai=ah.charAt(af);if(ag||" .,'\t".indexOf(ai)<0){switch(ai){case"�":ae+="i";break;case"�":ae+="u";break;case"�":ae+="o";break;case"�":ae+="a";break;case"�":ae+="e";break;case"�":ae+="e";break;default:ae+=ai}}}return ae.toUpperCase()}function F(ah,ai){var ae=ah.toUpperCase();var ak=ae.indexOf(ai);if(ak>0){var aj=ae.charAt(ak-1);while(aj!=" "&&aj!="'"&&aj!="\t"&&aj!=","&&aj!="."){ak=ae.indexOf(ai,ak+1);if(ak<0){break}aj=ae.charAt(ak-1)}}if(ak<0){return{key:"",item:ah,html:ah}}var ag=ah.indexOf(" ",ak+ai.length);if(ag<0){ag=ah.length}var af=ah.substring(ak,ag);return{key:af,item:ah,html:ah.substring(0,ak)+"<b>"+af+"</b>"+ah.substring(ag)}}function c(ae){return ae.parentNode.parentNode}function h(ag,ae){var af=ag.offsetTop;if(ae){af+=ag.offsetHeight-c(ag).offsetHeight}c(ag).scrollTop=af}function y(ag,af){var ai=document.getElementById(f+ag);var ah=document.getElementById(f+q);if(ag!=q){ah.style.backgroundColor=""}ai.style.backgroundColor="#eee";q=ag;var ae=c(ai);if(ai.offsetTop<ae.scrollTop||ai.offsetTop+ai.offsetHeight>ae.scrollTop+ae.offsetHeight){h(ai,af)}}function S(af){var ae=af>q;if(af<0){af=0}if(af>d-1){af=d-1}y(af,ae)}function A(ae){S(ae);u().value=r[q];ad()}function E(){var ae=m();var an=u();var ao=p(an.value);var al=p(an.value,true);g=al;var ak=W();if(ak){var aq="";var am=[];var af=[];d=0;r=[];q=-1;for(var aj=0;aj<ak.length;aj++){if(ak[aj]>=ao){if(ak[aj].indexOf(ao)<0){break}for(var ai=aj;ai<ak.length;ai++){if(ak[ai]>ao&&ak[ai].indexOf(ao)<0){break}var ap=ak[ai].substring(ak[ai].indexOf("/")+1);if(am[ap]==null){af.push(F(ap,al));am[ap]=""}}break}}af=af.sort(function(au,at){var ar=au.key.localeCompare(at.key);if(ar==0){ar=au.item.localeCompare(at.item)}return ar});for(var aj=0;aj<af.length;aj++){aq+='<li class="estremiListItem" onclick="estremiConfirmItem('+d+')" id="'+f+d+'">'+af[aj].html+"</li>";r[d]=af[aj].item;if(q<0&&af[aj].key!=""){q=aj}d++}if(q<0){q=0}if(aq!=""){var ag=15;var ah=oldMSIE()?4:0;ae.innerHTML='<ul class="estremiListList">'+aq+"</ul>";$(ae).css("height","auto");x(ae,an);ae.style.display="";y(q);$(ae).css("height",$(ae).outerHeight()>400?"400px":"auto");x(ae,an)}else{ae.style.display="none"}}}function M(){var af=m();if(af){var ae=u();if(ae){var ag=p(ae.value,true);if(ag.length&&(!aa()||g!=ag)){E()}}}}function T(ae){if(!ae){ae=window.event}if(ae){ae.cancelBubble=true;ae.returnValue=false;if(ae.stopPropagation){ae.stopPropagation()}if(ae.preventDefault){ae.preventDefault()}}}function x(af,ae){var ae=$(ae);var ag=ae.offset();$(af).css("width",((ae.width()*1.5)|0)+"px").css("left",ag.left+"px").css("top",(ag.top+ae.outerHeight())+"px")}var N=null;function J(ae){window.clearTimeout(N);N=window.setTimeout(function(af){if(aa()){x(m(),u())}},200);return true}function aa(){return m().style.display!="none"}function l(af,ae){if(aa()){switch(af.keyCode){case 13:A(q,ae.name);T(af);break;case 33:S(q-ab-1);T(af);break;case 34:S(q+ab-1);T(af);break;case 35:if(af.ctrlKey){S(d-1);T(af)}break;case 36:if(af.ctrlKey){S(0);T(af)}break;case 38:S(q-1);T(af);break;case 40:S(q+1);T(af);break;default:}}else{if(af.keyCode==40){V(af)}}return true}function V(ae){ae.cancelBubble=true;ae.returnValue=false;E();return true}function B(ae){return V(ae)}function t(ae){return l(ae,u())}function G(ah){var af=false;var ag=u();var ae=ah.altKey||ah.ctrlKey;if(aa()){switch(ah.keyCode){case 8:if(ag.value==""){ad();af=true}break;case 9:if(!(ah.altKey||ah.ctrlKey)){ad()}af=true;break;case 13:T(ah);case 16:case 17:case 18:af=true;break;case 27:ad();T(ah);af=true;break;case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:T(ah);af=true;break;default:}}else{switch(ah.keyCode){case 8:if(ag.value!=""){break}case 9:case 16:case 17:case 18:case 13:case 27:case 35:case 36:case 37:case 39:af=true;break;default:}}if(!af&&!ae){M()}return true}$(document).ready(function(){Q();if(window.estremiLoaded){estremiLoaded()}});window.Estremi={};window.estremiQuery=function(ae){return o(ae)};window.estremiInputEl=function(){return u()};window.estremiConfirmItem=function(ae){return A(ae)}})();function clearTemplate(b){$.each($(".chkcontent",b),function(c,d){if(trim($('*[data-role$="content"]',d).text())==""){$(d).remove()}})}window.onYDocUpdateDone=function(c,b){if(b.kind!="sic"){$("#idContainer").html(b.id)}clearTemplate(c)};function safeContent(f,d,b){try{return f[d][b]}catch(c){}return""}function nlz(b){return b;while(b.length&&b.charAt(0)=="0"){b=b.substring(1)}return b}function linkThere(k,l,m){if(m!=0){return null}var u="";for(var e=0;e<l[k+"-numdec"].length;e++){var c=safeContent(l,k+"-numdec",e);var h=safeContent(l,k+"-an",e);var b=safeContent(l,k+"-nmas",e);var s=l.origin?l.origin:l.kind;var q='target="_blank"';var g='<img src="pix/nw.gif" title="nuova pagina" />';var f="N. "+nlz(c)+" del "+h;var p="Rv. "+nlz(b);var d="detail.html?"+(s=="penale"?"numdep":"numdec")+":"+c+"+AND+anno:"+h+"+AND+kind:"+s;var i="detail.html?nmas:"+b+"+AND+kind:"+s;var o=window.K?'<a tabindex="0" href="'+d+'" '+q+">"+f+g+"</a> "+(b!=""?'<a tabindex="0" href="'+i+'" '+q+">"+p+g+"</a>":""):'<a tabindex="0" href="'+d+'">'+f+"</a> "+(b!=""?'<a tabindex="0" href="'+i+'">'+p+"</a>":"");u+="<li>"+o+"</li>"}return"<ul>"+u+"</ul>"}var _ocr=[];var szdec2l={"1":"PRIMA","2":"SECONDA","3":"TERZA","4":"QUARTA","5":"QUINTA","6":"SESTA","7":"SETTIMA",F:"FERIALE",L:"LAVORO",U:"UNITE"};var ssz2l={"5":"T",L:"LAVORO"};var ssz=function(d){var c=ssz2l[d];var b=(c||d);if(val=="0"){return null}return b};var szdec=function(c){var b=szdec2l[c];return b||c};if(Y&&Y.writeContent){var formatDate=function(e){var d=", ";var b=e.split(d);for(var c=0,e="";c<b.length;c++){if(c>0){e+=d}if(b[c].length!=8){e+=b[c]}else{e+=b[c].substring(6)+"/"+b[c].substring(4,6)+"/"+b[c].substring(0,4)}}return e};function formatocrtext(d){var b=d.ocr;for(var c=0;b&&c<b.length;c++){b[c]=b[c].substring(0,256)}}var previousHl2doc=Y.hl2doc;Y.hl2doc=function(c,b){c.ocrfull=c.ocr[0];previousHl2doc(c,b);if(b&&b.ocr){c.ocr=b.ocr}else{formatocrtext(c)}};var stripLeading=function(b,c){while(c.indexOf(b)==0){c=c.substring(b.length)}return c};var previousWriteContent=Y.writeContent;Y.writeContent=function(l,b,m,e){var h=function(){return((location.port&&location.port.length)||location.host=="www.3dendless.com"||location.host=="localhost"||location.host=="127.0.0.1")?"http://www.italgiure.giustizia.it":""};var i=function(o){if(!l.filename||!l.filename[o]){return null}var n=l.filename[o];return h()+"/xway/application/nif/clean/hc.dll?verbo=attach&db="+l.kind+"&id="+(n.indexOf(".clean.")>0?n:n.replace(".pdf",".clean.pdf"))};var c=function(n){return n.kind=="snciv"||n.kind=="snpen"};var d=l[b];if(d){if(m>=0){d=d[m]}else{if(!(typeof d==="string")){d=d[0]}}d=trim(d)}if(b=="ocr"){if(d.length>0){d=" ... "+d;if(m+1==l[b].length){d=d+" ... "}}}else{if(b=="nsz"){if(!d||!c(l)){return null}d=d+" "+(l.kind=="snciv"?"CIVILE":"PENALE")}else{if(b=="szdec"){d=szdec(d)}else{if(b=="ssz"){d=ssz(d)}else{if(b=="kind"){if(d=="snciv"){d="CIVILE"}else{if(d=="snpen"){d="PENALE"}}}else{if(b=="numcard"){d=stripLeading("0",l.kind=="penale"?l.numdep:l.numdec)}else{if(b=="num"){var f=l.kind=="penale"?l.numdep:l.numdec;d=stripLeading("0",f)}else{if(d&&b=="filename"){d="";for(var g=0;l[b]&&g<l[b].length&&g<1;g++){d+='<span><img class="toDocument pdf rowIcon" data-arg="'+escape(i(g))+'" alt="formato pdf" src="pix/pdf.png"/></span>'}}else{if(b=="requisitoria"){d="";for(var g=1;l.filename&&g<l.filename.length&&g<2;g++){d+='<br/><img class="rowIcon" style="visibility:hidden;" src="pix/pdf.png"/>&nbsp; <span class="toDocumentRequisitoria pdf" data-arg="'+escape(i(g))+'" style="text-decoration:underline;font-style:italic;font-weight:normal;">Vedi Requisitoria Procuratore generale</span>'}}else{if(b=="testoocr"){_ocr[e]=l.ocrfull;d='<span class="toDocument txt" data-arg="'+e+'"><img class="rowIcon" alt="testo ocr" src="pix/text.png"/></span>'}else{if(b=="ecli"){d=" (ECLI:IT:CASS:"+l.anno+":"+stripLeading("0",l.kind=="penale"?l.numdep:l.numdec)+(l.kind=="snpen"?"PEN":"CIV")+")"}else{if(b=="datdec"||b=="datdep"||b=="sic-data_ud"||b=="sic-datdep"){d=formatDate(d);if((l.kind=="snciv"&&b=="datdec")||(l.kind=="snpen"&&b=="datdep")){d='<span style="font-weight:normal">'+d+"</span>"}}else{if(b=="trattaz"){if(d=="U"){d="Ud.&#160;"}else{if(d=="C"){d="Cc.&#160;"}}}else{if(b=="piccolaVoce"){var k=d.indexOf(" ");if(k==6){k=d.lastIndexOf(" - ");d=d.substring(3,6)+d.substring(k>0?k+2:6)}}else{if(b=="ved-numdec"){d=linkThere("ved",l,m)}else{if(b=="con-numdec"){d=linkThere("con",l,m)}else{if(b=="dif-numdec"){d=linkThere("dif",l,m)}else{if(b=="sic-ved-numdec"){d=linkThere("sic-ved",l,m)}else{d=previousWriteContent(l,b,m,e)}}}}}}}}}}}}}}}}}}return d}}function toTargetDoc(e,c){var d=$(".text2pdf",$(c)).get(0);if(d){var f=$('span[data-arg="ocr"]',d.parentElement.parentElement).text();if(f.indexOf("in fase di oscuramento")>=0||f.indexOf("in fase di valutazione oscuramento")>=0){return false}}var b=($(e.target).hasClass("pdf")?$(e.target):$(".toDocument.pdf",$(c))).attr("data-arg");if(!b){return}open(unescape(b));$.ajax({type:"GET",url:"http://"+location.hostname+"/xway/application/nif/isapishare/hc.dll?app.document="+encodeURIComponent(unescape(b)),async:true,success:function(g){},error:function(i,h,g){consoleLog("document tracking error: "+g+", status:"+i.status)}})}function toTargetText(b){openDetail(null,b)}function firstPage(){return 0}function lastPage(b){return(((b.count()-1)/b.pageSize())|0)*b.pageSize()}function nextPage(c){var b=c.position()+c.pageSize();return(b>c.count()-1?c.position():b)}function prevPage(c){var b=c.position()-c.pageSize();return(b<0?0:b)}function middleNextPage(b){return(((b.position()+(((b.count()-b.position())/2)|0))/b.pageSize())|0)*b.pageSize()}function middlePrevPage(c){var b=(((((c.position()-1)/2)|0)/c.pageSize())|0)*c.pageSize();return(b<0?0:b)}function pix2val(g,f,d,e){if(g.x<0||g.y<0||(g.x==0&&g.y==0)||g.x>=f.w||g.y>=f.h){return d[1][1](e)}var c=(f.w+1)/d.length,b=(f.h+1)/d.length;return d[(g.y/b)|0][(g.x/c)|0](e)}var flipLeftBottom=[[prevPage,prevPage,prevPage],[middlePrevPage,prevPage,prevPage],[firstPage,middlePrevPage,prevPage]];var flipLeftTop=[[firstPage,middlePrevPage,prevPage],[middlePrevPage,prevPage,prevPage],[prevPage,prevPage,prevPage]];var flipRightBottom=[[nextPage,nextPage,nextPage],[nextPage,nextPage,middleNextPage],[nextPage,middleNextPage,lastPage]];var flipRightTop=[[nextPage,middleNextPage,lastPage],[nextPage,nextPage,middleNextPage],[nextPage,nextPage,nextPage]];function changeFlipTitle(g,h,b,c){var f=function(k,e){return((k+e-1)/e)|0};var d=f(c.count(),c.pageSize());var i=f(1+pix2val({x:g.offsetX,y:g.offsetY},{w:h.clientWidth,h:h.clientHeight},b,c),c.pageSize());$(h).attr("title",i+"/"+d)}function flipHandlers(){var b={pageSize:Y.docsxrow,position:function(){return Y.docStart()-1},count:Y.selcount};$(".flipLeft.flipBottom").click(function(c){Y.updateDocOffset(1+pix2val({x:c.offsetX,y:c.offsetY},{w:this.clientWidth,h:this.clientHeight},flipLeftBottom,b))});$(".flipLeft.flipTop").click(function(c){Y.updateDocOffset(1+pix2val({x:c.offsetX,y:c.offsetY},{w:this.clientWidth,h:this.clientHeight},flipLeftTop,b))});$(".flipRight.flipBottom").click(function(c){Y.updateDocOffset(1+pix2val({x:c.offsetX,y:c.offsetY},{w:this.clientWidth,h:this.clientHeight},flipRightBottom,b))});$(".flipRight.flipTop").click(function(c){Y.updateDocOffset(1+pix2val({x:c.offsetX,y:c.offsetY},{w:this.clientWidth,h:this.clientHeight},flipRightTop,b))});$(".flipLeft,.flipRight,.cardInstance").keydown(function(c){if(c.keyCode==13){$(this).click()}});$(".flipLeft.flipBottom").hover(function(c){$(this).mousemove(function(d){changeFlipTitle(d,this,flipLeftBottom,b)})},function(c){$(this).unbind("mousemove")});$(".flipLeft.flipTop").hover(function(c){$(this).mousemove(function(d){changeFlipTitle(d,this,flipLeftTop,b)})},function(c){$(this).unbind("mousemove")});$(".flipRight.flipBottom").hover(function(c){$(this).mousemove(function(d){changeFlipTitle(d,this,flipRightBottom,b)})},function(c){$(this).unbind("mousemove")});$(".flipRight.flipTop").hover(function(c){$(this).mousemove(function(d){changeFlipTitle(d,this,flipRightTop,b)})},function(c){$(this).unbind("mousemove")})}function flipEnable(){var i=Y.docStart()-1;var f=i>0;var e=i+Y.docsxrow();var d=e<Y.selcount();var h=((Y.selcount()+Y.docsxrow()-1)/Y.docsxrow())|0;var b=(i/Y.docsxrow())|0;var g=((Y.docStart()+2*Y.docsxrow()-1)/Y.docsxrow())|0;$(".flipLeft").attr("title",""+b+"/"+h).css("display",f?"":"none");$(".flipRight").attr("title",""+g+"/"+h).css("display",d?"":"none");var c={pageSize:Y.docsxrow,position:function(){return i},count:Y.selcount};$(".flipLeft").toggleClass("flipMulti",f&&prevPage(c)!=firstPage(c));$(".flipRight").toggleClass("flipMulti",d&&nextPage(c)!=lastPage(c))}function resizeDetail(){var b=$("#detailPanel").get(0);if(b){var c=0.74;var e=(1-c)/2;var d=$(window).width(),f=$(window).height();$(b).css("width",d+"px").css("height",f+"px");var l=$("#detailContent").get(0);$(l).css("left",(d*e)+"px").css("width",(d*c)+"px").css("height",(f*c)+"px");var h=$("#detailData").width();var i=(d*c-h)/2;$(".gradient",$("#detailContent")).css("left",i+"px").css("width",h+"px");$(".tneidarg",$("#detailContent")).css("left",i+"px").css("width",h+"px");var g=$(l).outerHeight(true);var k=(g-f*c)/2;$(l).css("top",(f*e-k)+"px")}}$(window).resize(function(){resizeDetail()});function openPdfDetail(d,b){var c=$('span[data-arg="ocr"]',d).text();if(c.indexOf("in fase di oscuramento")<0&&c.indexOf("in fase di valutazione oscuramento")<0){if(b.target.nodeName!="IMG"&&b.target.nodeName!="A"){toTargetDoc($(".toDocument.pdf",d).attr("data-arg"))}}else{if(b){b.preventDefault();b.stopPropagation()}}}function openDetail(d,b){b=+b;b=d?parseInt($(".docPosition",d).text(),10):b;$("#detailPanel").remove();$('<div id="detailPanel" style="position:fixed; top:0; left:0; z-index:99999;"><div id="detailFade" style="background-color:#bbb; opacity:'+(d?0:0.666)+'; width:100%; height:100%;"></div><div id="detailContent" style="position:fixed; opacity:1; background-color:white; border:solid 1px #888;box-shadow: #444 0px 0px 16px;padding-top:1.4em; padding-bottom:1em;padding-right:2px;"><a href="javascript:void(0)" class="detailClose" id="detailCloser" onclick="setTimeout(function(){closeDetail(event);},100);return false;" tabindex="0" title="chiude dettaglio" accesskey="x"></a>'+(b>0?'<div class="flipLeft flipBottom flipDetail'+(b>1?" flipMulti":"")+'" style="position:absolute; left:0; bottom:0;" aria-label="documento precedente" title="precedente ('+b+" di "+Y.selcount()+')" role="button" tabindex="0"></div>':"")+(b<Y.selcount()-1?'<div class="flipRight flipTop flipDetail'+(b<Y.selcount()-2?" flipMulti":"")+'" style="position:absolute; right:0; top:0;" title="successivo ('+(b+2)+" di "+Y.selcount()+')" role="button"></div>':"")+'<div style="height:100%; overflow:auto;"><div id="detailData" style="padding:2em; padding-top:9px; padding-bottom:9px;" tabindex="0"></div></div>'+(b<Y.selcount()-1?'<div class="flipRight flipBottom flipDetail'+(b<Y.selcount()-2?" flipMulti":"")+'" style="position:absolute; right:0; bottom:0;" aria-label="documento successivo" title="successivo ('+(b+2)+" di "+Y.selcount()+')" role="button" tabindex="0"></div>':"")+"</div></div>").appendTo("body");resizeDetail();var c=$("#sortchoice").val();$.ajax({type:"POST",url:Y.solr()+"/select",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,data:"start="+b+"&rows=1&q="+encodeURIComponent(Y.selid())+(c&&c.length?"&sort="+encodeURIComponent(c):"")+(Y.hlSelid()?"&hl.q="+encodeURIComponent(Y.hlSelid()):"")+"&wt=json&indent=off&fl=&hl=true&hl.fl=*&hl.fragsize=0&hl.simple.pre="+encodeURIComponent('<em class="hit">')+"&hl.simple.post="+encodeURIComponent("</em>"),success:function(e){var f=$("#detailContent").get(0);var g={pageSize:function(){return 1},position:function(){return b},count:Y.selcount};$(".flipLeft.flipBottom.flipDetail",f).click(function(i){openDetail(null,pix2val({x:i.offsetX,y:i.offsetY},{w:this.clientWidth,h:this.clientHeight},flipLeftBottom,g))});$(".flipRight.flipBottom.flipDetail,.flipRight.flipTop.flipDetail",f).click(function(i){openDetail(null,pix2val({x:i.offsetX,y:i.offsetY},{w:this.clientWidth,h:this.clientHeight},flipRightBottom,g))});$(".flipLeft.flipBottom.flipDetail").hover(function(i){$(this).mousemove(function(k){changeFlipTitle(k,this,flipLeftBottom,g)})},function(i){$(this).unbind("mousemove")});$(".flipRight.flipBottom.flipDetail,.flipRight.flipTop.flipDetail").hover(function(i){$(this).mousemove(function(k){changeFlipTitle(k,this,flipRightBottom,g)})},function(i){$(this).unbind("mousemove")});$(".flipLeft,.flipRight,.detailClose",f).keydown(function(i){if(i.keyCode==13){$(this).click()}});f=$("#detailData").get(0);var h=Y.parseDocsResponse(e);Y.parseTemplate(f,templateNode.cloneNode(true),h.response.docs[0],b);clearTemplate(f);_storeFocus(document.activeElement);$("#detailData").focus();$('[tabindex="0"]',$("#mainpage")).attr("tabindex","-1")},error:function(g,f,e){alert("detail error: "+e+", status:"+g.status)}});$("#detailFade").animate({opacity:0.666},666)}var templateNode=null;var _focusData=null;var _storeFocus=function(b){if(!_focusData){_focusData=b}};var _restoreFocus=function(){$(_focusData).focus();_focusData=null};var _stopEvent=function(b){if(!b){b=window.event}if(b){if(b.stopPropagation){b.stopPropagation()}if(b.preventDefault){b.preventDefault()}b.cancelBubble=true;b.returnValue=false}return false};function closeDetail(b){_stopEvent(b);$("#detailContent").remove();$('[tabindex="-1"]',$("#mainpage")).attr("tabindex","0");$("#detailFade").animate({opacity:0},666,function(){$("#detailPanel").remove();_restoreFocus()})}function displayContent(){$("#contentCell").css("vertical-align","top").css("text-align","");$("#noData").css("display","none");$("#contentData").css("display","")}var prevQueryResponse=Y.queryResponse;var noDocsContent=function(b){return b.replace($("#startquery").val(),"").replace(/[()]/g,"")==""};Y.queryResponse=function(b,i){if(b.response.numFound==0){if(!b.responseHeader.params.fuzzy){$("#sortchoice").val("");_sortAuto(true);return{reload:function(){Y.query(null,true)}}}$("div.dataset.cards").html("");$("div#resultMessage").html("la ricerca impostata non ha selezionato nessun documento");$("div#resultMessage").css("display","");$("div.dataset.cards").css("display","none");$("#facets").css("display","none");displayContent();updateContentHeight();return false}$("div#resultMessage").css("display","none");$("#facets").css("display","");$("div.dataset.cards").css("display","");var c=noDocsContent(b.responseHeader.params.q);if(c){$("#contentCell").css("vertical-align","top").css("text-align","");$("#contentData").css("display","none");$("#noData").css("display","")}else{displayContent()}var k=prevQueryResponse(b,i);if(!k||c){return k}var e=function(m,l){return(((m+l)/l)|0)};var h=function(m,l){return(((m+l-1)/l)|0)};var d="pagina "+e(b.response.start,Y.docsxrow())+" di "+h(b.response.numFound,Y.docsxrow());$(".page").attr("title",d).attr("aria-label",d);var f=$(".card",$(".cards"));$.each(f,function(m,n){var l="documento "+(b.response.start+m+1)+" di "+b.response.numFound;$(n).attr("title",l);$(">a",n).attr("accesskey",""+(m>8?0:m+1))});if(b.responseHeader.params.fuzzy){$(".dataset.cards").prepend('<div style="padding:.5em;padding-top:1em;padding-bottom:0;font-size:100%;" class="title">&egrave; stata attivata la ricerca per rilevanza<hr style="border:0;height:0;border-top:1px solid rgba(0,0,0,0.1);border-bottom:1px solid rgba(255,255,255,0.3);"/></div>')}var g=function(m,l,o){var r=h(l,o);if(r<2){return""}var s=e(m,o),n=10;var q=s-4<1?1:s-4;var t=s+5>r?r:s+5;if(t<r&&t-q+1<n){t=t+n-(t-q+1)}if(q>1&&t-q+1<n){q=q-n+(t-q+1)}var u="";if(s>1){u+='<a class="pager pagerArrow" title="pagina precedente" tabindex="0" data-arg="'+(s-1)+'">&lt;</a>&nbsp;&nbsp;'}for(var p=q;p<=t;p++){if(p==s){u+=""+p+"&nbsp;"}else{u+='<a class="pager" tabindex="0" data-arg="'+p+'" title="pagina '+p+'" aria-label="pagina '+p+'">'+p+"</a>&nbsp;"}}if(t<r){u+='&nbsp;<span class="pager pagerArrow" title="pagina successiva" role="button" tabindex="0" data-arg="'+(s+1)+'">&gt;</span>'}return'<div class="pages">'+u+"</div>"};$(".dataset.cards").append(g(b.response.start,b.response.numFound,Y.docsxrow())+'<a class="flipLeft flipTop" style="position:absolute; left:0; top:0;" title="precedente" aria-label="pagina precedente" tabindex="0" accesskey="-"></div><a class="flipRight flipTop" style="position:absolute; right:0; top:0;" title="successivo"></a><a class="flipLeft flipBottom" style="position:absolute; left:0; bottom:0;" title="precedente"></a><a class="flipRight flipBottom" style="position:absolute; right:0; bottom:0;" title="successivo" aria-label="pagina successiva" tabindex="0" accesskey="+"></a>');$(".pager").unbind();$(".pager").click(function(){var l=$(this).attr("data-arg");Y.updateDocOffset((l-1)*Y.docsxrow()+1)});$(".pager").keydown(function(l){if(l.keyCode==13){$(this).click()}});$(".flipLeft,.flipRight").unbind();flipEnable();flipHandlers();updateContentHeight();$("#contentData").focus();return k};function dataContentHeight(){return $(window).height()-$(".header").outerHeight()-$(".footer").outerHeight()-4}function updateContentHeight(){$("#contentPanel").css("height",""+dataContentHeight()+"px");var b=$("#contentData");b.css("height",""+($(window).height()-b.offset().top-$(".footer").outerHeight()-8)+"px");var d=$(".dataset.cards");d.css("height","");if(d.outerHeight()<b.innerHeight()){d.css("height",""+(b.innerHeight()-4)+"px")}}function snippetsSetWindow(b,c){var d=c.offset();b.css("width",c.width()+"px").css("left",d.left+"px").css("top",(d.top+c.outerHeight())+"px")}var snippetsResizeTimeoutId=null;$(window).resize(function(){window.clearTimeout(snippetsResizeTimeoutId);updateContentHeight();snippetsResizeTimeoutId=window.setTimeout(function(b){snippetsSetWindow($("#snippets"),$("#searchterm"))},200)});$(document).ready(function(){updateContentHeight();Y.init();var b=function(h){h=h||"";var e=h&&h!="",g=$("#snippetsContent");var f=$("#searchterm");g.html('<ul class="snippets">'+h+"</ul>");$("li",g).click(function(){f.focus();$(this).addClass("selected");$("#z-form").submit()});var d=$("#snippets");d.css("display",e?"":"none").css("height","auto");snippetsSetWindow(d,f);d.css("height",d.outerHeight()>400?"400px":"auto");snippetsSetWindow(d,f)};$("#z-form").submit(function(f){var d=$("li.selected",$("#snippetsContent"));if(d.length==1){$("#searchterm").val(d.text())}if(f&&f.stopPropagation){f.stopPropagation()}b();return Y.query()});$("#searchterm").keyup(function(i){if(i.which==13&&MSIEVersion()<8){$("#z-form").submit()}if(trim(this.value)==""||i.which==13||i.which==27){return b()}var f=function(t){if(t!=38&&t!=40){return}var q=$("#snippetsContent");var n=$("li",q).length;var m=$("li.selected",q).toggleClass("selected");var r=m.length==0?(t==38?n:-1):$(m).prevAll().length;r+=(t==38?-1:+1);if(r<0){r=n-1}if(r>=n){r=0}var p=$("li:nth-child("+(r+1)+")",q);if(p){p.addClass("selected");p=p.get(0);var e=$("#snippets").get(0);if(p.offsetTop<e.scrollTop||p.offsetTop+p.offsetHeight>e.scrollTop+e.offsetHeight){var l=p.offsetTop;if(t==40&&r){l+=p.offsetHeight-e.offsetHeight}e.scrollTop=l}}};if(i.which>32&&i.which<41){return f(i.which)}if(!window.suggestCounter){window.suggestCounter=1}suggestCounter++;var k='/\\+-&|!(){}[]^~*?:"; ';var d=function(n){var e="";for(var l=0;l<n.length;l++){var m=n.charAt(l);if(k.indexOf(m)>=0){e+="\\"}e+=m}return e};var g=function(l){var q="";var e=" e ";var n=0,p=-1;for(var m=0;m<l.length;m++){var o=l.charAt(m);if(o=="="){n++;q=q+'"'}else{q=q+o}}if(n==0){return q}q='"'+q;n++;if(n%2!=0){if((p=q.indexOf(e))>0&&q.charAt(p+e.length)!='"'){q=q.substring(0,p+e.length)+'"'+q.substring(p+e.length)}}return q};var h='{!boost b=score}kind:"key" AND key:'+d(this.value.replace(/"/g,""))+"*";$.ajax({type:"POST",url:Y.solr()+"/select?app.suggester",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,data:"rows=16&q="+encodeURIComponent(h)+"&suggestCounter="+suggestCounter+"&wt=json&indent=off&fl=key",success:function(e){var n=Y.parseDocsResponse(e);if(n.responseHeader.params.suggestCounter!=suggestCounter){return}var o="",m=null;for(var l=0;l<n.response.docs.length;l++){o+="<li>"+g(n.response.docs[l].key[0])+"</li>"}b(o)},error:function(m,l,e){alert("detail error: "+e+", status:"+m.status)}})});$("#searchterm").blur(function(d){setTimeout(function(){if(!document.activeElement||document.activeElement.id!="searchterm"){b()}},200)});$("#dataTemplate").html('<div style="text-align:left; position:relative;" class="dataset" data-role="dataset"> <p class="chkcontent liscio discorso indentatoHard"><span data-role="content" data-arg="ocrfull"></span></p></div>');templateNode=$("#dataTemplate").get(0).cloneNode(true);$("#dataTemplate").remove();var c=estremiConfirmItem;window.estremiConfirmItem=function(d){c(d);Y.query()};$(".resizer div").click(function(){var d=$(this).parent().attr("class");$("body").removeClass("small medium large").addClass(d);updateContentHeight();return false});$("#sortchoice").change(function(){_sortAuto($("#sortchoice option:selected").text().indexOf("auto")>=0);Y.query()})});function _resetSortAuto(){$("#sort_datdep").attr("selected","selected");_sortAuto(true)}var k_keyListChange=window.K.keyListChange;window.K.keyListChange=function(e,d,f){if(f=="[kind]"){_setSortAuto();_sortAuto(true)}k_keyListChange(e,d,f)};function _setSortAuto(){var b=document.forms[0]["[kind]"].value;if(b=='"snpen"'){$("#sort_datdec").attr("selected","selected")}else{$("#sort_datdep").attr("selected","selected")}}function _sortAuto(d){var b=$("#sortchoice option:selected");var c=b.text();$("#sortchoice option").each(function(g,h){var i=$(h).text();var f=" (auto)";var e=i.indexOf(f)>0;if($(h).is(":selected")&&d){if(!e){i=i+f}}else{i=i.replace(f,"")}$(h).text(i)})}function _updateSort(){var b=$("#sortchoice option:selected").text();if(b.indexOf("(auto)")>=0){_setSortAuto();_sortAuto(true)}}if(window.Y){Y.sort=function(){_updateSort();return $("#sortchoice").val()};Y.hasSort=function(){_updateSort();return $("#sortchoice").val()!=""};var xYdocsxrow=Y.docsxrow;Y.docsxrow=function(b){return b&&noDocsContent(b)?0:xYdocsxrow(b)}}if(window.K){K.key2user=function(c,b){if(b=="[kind]"){if(c=="snciv"){return"CIVILE"}if(c=="snpen"){return"PENALE"}}else{if(b=="[szdec]"){return szdec(c)}}return c}};